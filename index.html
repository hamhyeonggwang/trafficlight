        /* ë³´í–‰ì ì‚¬ëŒ ëª¨ì–‘ */
        .pedestrian-figure {
            width: 120px;
            height: 180px;
            position: relative;
            margin: 0 auto;
        }

        /* ë¨¸ë¦¬ */
        .pedestrian-head {
            width:<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´í–‰ì ì‹ í˜¸ë“± í›ˆë ¨ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: white;
            font-family: 'Arial', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            user-select: none;
        }

        /* ì „ì²´ ì‹ í˜¸ë“± ì»¨í…Œì´ë„ˆ */
        .traffic-light-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* í†µí•© ì‹ í˜¸ë“± ë°•ìŠ¤ */
        .pedestrian-signal {
            width: 320px;
            height: 720px;
            background: #2c3e50;
            border: 8px solid #34495e;
            border-radius: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            padding: 30px 20px;
        }

        /* ëŒ€ê¸°ì‹œê°„ ìˆ«ì í‘œì‹œ */
        .countdown-display {
            width: 200px;
            height: 80px;
            background: #1a1a1a;
            border: 4px solid #333;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            font-weight: bold;
            color: #ff6600;
            text-shadow: 0 0 10px #ff6600;
            margin-top: -10px;
        }

        /* ê°œë³„ ì‹ í˜¸ ë””ìŠ¤í”Œë ˆì´ */
        .signal-display {
            width: 260px;
            height: 280px;
            background: #000;
            border-radius: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            border: 4px solid #444;
            transition: all 0.3s ease;
        }

        /* ë¹„í™œì„±í™” ìƒíƒœ */
        .signal-display.inactive {
            opacity: 0.2;
            transform: scale(0.98);
            border-color: #222;
        }

        /* í™œì„±í™” ìƒíƒœ */
        .signal-display.active {
            opacity: 1;
            transform: scale(1);
            border-color: #666;
        }

        /* ë„íŠ¸ ë°°ê²½ íŒ¨í„´ - ê¸°ë³¸ */
        .signal-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 8px 8px;
            opacity: 0.5;
            z-index: 1;
        }

        /* í™œì„±í™”ëœ ë„íŠ¸ ë°°ê²½ - ë¹¨ê°„ë¶ˆ */
        .signal-display.red-active::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, #ff3333 2.5px, transparent 2.5px);
            background-size: 12px 12px;
            opacity: 0.95;
            z-index: 1;
        }

        /* í™œì„±í™”ëœ ë„íŠ¸ ë°°ê²½ - ì´ˆë¡ë¶ˆ */
        .signal-display.green-active::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, #33ff33 2.5px, transparent 2.5px);
            background-size: 12px 12px;
            opacity: 0.95;
            z-index: 1;
        }

        /* ì´ˆë¡ë¶ˆ ê¹œë¹¡ì´ëŠ” íš¨ê³¼ */
        .signal-display.green-active.warning::after {
            animation: warning-blink 0.5s infinite;
        }

        /* ê¹œë¹¡ì´ëŠ” íš¨ê³¼ */
        .signal-display.warning::after {
            animation: warning-blink 0.5s infinite;
        }

        @keyframes warning-blink {
            0%, 50% { opacity: 0.95; }
            51%, 100% { opacity: 0.2; }
        }

        .signal-icon {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
            transition: all 0.3s ease;
        }

        /* ë³´í–‰ì ì‚¬ëŒ ëª¨ì–‘ */
        .pedestrian-figure {
            width: 100px;
            height: 160px;
            position: relative;
            margin: 0 auto;
        }

        /* ë¨¸ë¦¬ */
        .pedestrian-head {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #000;
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.3s ease;
        }

        /* ëª¸í†µ */
        .pedestrian-body {
            width: 18px;
            height: 50px;
            background: #000;
            position: absolute;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.3s ease;
        }

        /* íŒ” */
        .pedestrian-arm {
            width: 14px;
            height: 40px;
            background: #000;
            position: absolute;
            top: 50px;
            transition: all 0.3s ease;
            border-radius: 3px;
        }

        .pedestrian-arm.left {
            left: 30px;
            transform: rotate(-15deg);
            transform-origin: top;
        }

        .pedestrian-arm.right {
            right: 30px;
            transform: rotate(15deg);
            transform-origin: top;
        }

        /* ë‹¤ë¦¬ */
        .pedestrian-leg {
            width: 16px;
            height: 60px;
            background: #000;
            position: absolute;
            top: 95px;
            transition: all 0.3s ease;
            border-radius: 3px;
        }

        .pedestrian-leg.left {
            left: 38px;
        }

        .pedestrian-leg.right {
            right: 38px;
        }

        /* ë¹¨ê°„ë¶ˆ ìƒíƒœ */
        .signal-icon.red .pedestrian-figure * {
            background: #000;
            box-shadow: 0 0 15px #ff3333, inset 0 0 3px rgba(255,51,51,0.3);
        }

        /* ì´ˆë¡ë¶ˆ ìƒíƒœ */
        .signal-icon.green .pedestrian-figure * {
            background: #000;
            box-shadow: 0 0 15px #33ff33, inset 0 0 3px rgba(51,255,51,0.3);
        }

        /* ì´ˆë¡ë¶ˆì¼ ë•Œ ê±·ëŠ” ìì„¸ */
        .signal-icon.green .pedestrian-arm.left {
            transform: rotate(30deg); /* ì™¼íŒ” ì•ìœ¼ë¡œ */
        }

        .signal-icon.green .pedestrian-arm.right {
            transform: rotate(-30deg); /* ì˜¤ë¥¸íŒ” ë’¤ë¡œ */
        }

        .signal-icon.green .pedestrian-leg.left {
            transform: rotate(15deg); /* ì™¼ë‹¤ë¦¬ ì•ìœ¼ë¡œ */
        }

        .signal-icon.green .pedestrian-leg.right {
            transform: rotate(-10deg); /* ì˜¤ë¥¸ë‹¤ë¦¬ ë’¤ë¡œ */
        }

        /* ì‹ í˜¸ë“± ë¼ë²¨ */
        .signal-label {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            font-weight: bold;
            color: #ecf0f1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        /* íƒ€ì´ë¨¸ */
        .timer-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
            font-size: min(15vw, 80px);
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
            z-index: 10;
            background: rgba(0,0,0,0.3);
            padding: min(4vw, 20px) min(8vw, 40px);
            border-radius: 20px;
            border: 3px solid rgba(255,255,255,0.2);
        }

        /* ì„¤ì • ë²„íŠ¼ */
        .settings-btn {
            position: fixed;
            top: min(4vw, 20px);
            right: min(4vw, 20px);
            background: rgba(52, 73, 94, 0.9);
            border: none;
            color: white;
            padding: min(3vw, 15px);
            border-radius: 50%;
            cursor: pointer;
            font-size: min(6vw, 24px);
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .sound-btn {
            position: fixed;
            top: min(4vw, 20px);
            left: min(4vw, 20px);
            background: rgba(52, 73, 94, 0.9);
            border: none;
            color: white;
            padding: min(3vw, 15px);
            border-radius: 50%;
            cursor: pointer;
            font-size: min(6vw, 24px);
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* íŒì—… ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            overflow-y: auto;
        }

        .modal-content {
            background-color: #2c3e50;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            color: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        .modal h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #3498db;
            font-size: 1.8em;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .setting-group {
            text-align: center;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
            font-weight: bold;
            color: #ecf0f1;
        }

        .setting-group select,
        .setting-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            background: #34495e;
            color: white;
            text-align: center;
        }

        .modal-buttons {
            text-align: center;
            margin-top: 25px;
        }

        .modal-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 5px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .modal-btn:hover {
            background: #2980b9;
        }

        .modal-btn.start {
            background: #27ae60;
        }

        .modal-btn.start:hover {
            background: #229954;
        }

        .modal-btn.stop {
            background: #e74c3c;
        }

        .modal-btn.stop:hover {
            background: #c0392b;
        }

        /* ì•ˆë‚´ íŒì—… */
        .info-popup {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(52, 73, 94, 0.95);
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            z-index: 1500;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            display: none;
            max-width: 90%;
        }

        .info-popup.show {
            display: block;
            animation: popup-show 0.5s ease;
        }

        @keyframes popup-show {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            100% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .info-popup.safe {
            background: rgba(39, 174, 96, 0.95);
        }

        .info-popup.danger {
            background: rgba(231, 76, 60, 0.95);
        }

        .info-popup.warning {
            background: rgba(243, 156, 18, 0.95);
        }

        /* ìƒíƒœ í‘œì‹œ */
        .status-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(52, 73, 94, 0.9);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            text-align: center;
            max-width: 90%;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #7f8c8d;
            font-size: 24px;
            cursor: pointer;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 480px) {
            .pedestrian-signal {
                border: 6px solid #34495e;
                border-radius: 30px;
            }
            
            .signal-display {
                border: 3px solid #444;
                border-radius: 20px;
            }
            
            .countdown-display {
                border: 3px solid #333;
                border-radius: 12px;
            }
        }

        /* ê°€ë¡œ ëª¨ë“œ ëŒ€ì‘ */
        @media (orientation: landscape) and (max-height: 600px) {
            .pedestrian-signal {
                width: min(50vw, 300px);
                height: min(90vh, 500px);
                padding: 2vh 2vw;
            }
            
            .timer-display {
                font-size: min(12vw, 60px);
                padding: min(2vw, 15px) min(4vw, 25px);
            }
        }
    </style>
</head>
<body>
    <!-- ì†Œë¦¬ í† ê¸€ ë²„íŠ¼ -->
    <button class="sound-btn" onclick="toggleSound()">ğŸ”Š</button>
    
    <!-- ì„¤ì • ë²„íŠ¼ -->
    <button class="settings-btn" onclick="openSettings()">âš™ï¸</button>
    
    <!-- ë©”ì¸ ì‹ í˜¸ë“± -->
    <div class="traffic-light-container">
        <div class="pedestrian-signal">
            <!-- ë¹¨ê°„ë¶ˆ (ìœ„ìª½) -->
            <div class="signal-display active" id="redDisplay">
                <div class="signal-icon red">
                    <div class="pedestrian-figure">
                        <div class="pedestrian-head"></div>
                        <div class="pedestrian-body"></div>
                        <div class="pedestrian-arm left"></div>
                        <div class="pedestrian-arm right"></div>
                        <div class="pedestrian-leg left"></div>
                        <div class="pedestrian-leg right"></div>
                    </div>
                </div>
            </div>

            <!-- ì´ˆë¡ë¶ˆ (ì•„ë˜ìª½) -->
            <div class="signal-display inactive" id="greenDisplay">
                <div class="signal-icon green">
                    <div class="pedestrian-figure">
                        <div class="pedestrian-head"></div>
                        <div class="pedestrian-body"></div>
                        <div class="pedestrian-arm left"></div>
                        <div class="pedestrian-arm right"></div>
                        <div class="pedestrian-leg left"></div>
                        <div class="pedestrian-leg right"></div>
                    </div>
                </div>
            </div>
            
            <!-- ëŒ€ê¸°ì‹œê°„ ìˆ«ì í‘œì‹œ -->
            <div class="countdown-display" id="countdownDisplay">--</div>
        </div>
    </div>

    <!-- íƒ€ì´ë¨¸ -->
    <div class="timer-display" id="timer">--</div>

    <!-- ìƒíƒœ í‘œì‹œ -->
    <div class="status-bar" id="statusBar">ëŒ€ê¸° ì¤‘...</div>

    <!-- ì•ˆë‚´ íŒì—… -->
    <div class="info-popup" id="infoPopup"></div>

    <!-- ì„¤ì • ëª¨ë‹¬ -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeSettings()">âœ•</button>
            <h2>ğŸš¦ ì‹ í˜¸ë“± ì„¤ì •</h2>
            
            <div class="settings-grid">
                <div class="setting-group">
                    <label for="lanes">ë„ë¡œ ì°¨ì„  ìˆ˜</label>
                    <select id="lanes" onchange="calculateWalkTime()">
                        <option value="1">1ì°¨ë¡œ (3.5m)</option>
                        <option value="2" selected>2ì°¨ë¡œ (7m)</option>
                        <option value="3">3ì°¨ë¡œ (10.5m)</option>
                        <option value="4">4ì°¨ë¡œ (14m)</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="roadType">ë„ë¡œ ìœ í˜•</label>
                    <select id="roadType" onchange="calculateWalkTime()">
                        <option value="normal">ì¼ë°˜ ë„ë¡œ</option>
                        <option value="school" selected>ì–´ë¦°ì´ ë³´í˜¸êµ¬ì—­</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="walkTime">ë³´í–‰ ì‹œê°„ (ì´ˆ)</label>
                    <input type="number" id="walkTime" value="13" min="10" max="30" readonly>
                    <small style="color: #bdc3c7; font-size: 12px;">ìë™ ê³„ì‚°ë¨</small>
                </div>
                
                <div class="setting-group">
                    <label for="waitTime">ëŒ€ê¸° ì‹œê°„ (ì´ˆ)</label>
                    <input type="number" id="waitTime" value="30" min="20" max="60">
                </div>
                
                <div class="setting-group">
                    <label for="warningTime">ê²½ê³  ì‹œê°„ (ì´ˆ)</label>
                    <input type="number" id="warningTime" value="5" min="3" max="10">
                </div>
                
                <div class="setting-group">
                    <div style="background: rgba(52, 152, 219, 0.2); padding: 15px; border-radius: 10px; font-size: 14px;">
                        <strong>ğŸ“ ê³„ì‚° ê³µì‹:</strong><br>
                        â€¢ ì¼ë°˜ ë„ë¡œ: ì§„ì…ì‹œê°„ 7ì´ˆ + (ê±°ë¦¬ Ã— 0.8ì´ˆ/m)<br>
                        â€¢ ì–´ë¦°ì´ ë³´í˜¸êµ¬ì—­: ì§„ì…ì‹œê°„ 7ì´ˆ + (ê±°ë¦¬ Ã— 1.2ì´ˆ/m)
                    </div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn start" onclick="startTraining()" id="startBtn">ğŸš¦ í›ˆë ¨ ì‹œì‘</button>
                <button class="modal-btn stop" onclick="stopTraining()" id="stopBtn" style="display:none;">â¹ï¸ í›ˆë ¨ ì¤‘ì§€</button>
                <button class="modal-btn" onclick="closeSettings()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        let trainingState = {
            isRunning: false,
            currentPhase: 'wait', // 'wait', 'walk', 'warning'
            timeLeft: 0,
            soundEnabled: true,
            intervalId: null,
            settings: {
                lanes: 2,
                roadType: 'school',
                walkTime: 13,
                waitTime: 30,
                warningTime: 5
            }
        };

        // íš¡ë‹¨ë³´ë„ ê±°ë¦¬ ë° ë³´í–‰ ì‹œê°„ ê³„ì‚°
        function calculateWalkTime() {
            const lanes = parseInt(document.getElementById('lanes').value);
            const roadType = document.getElementById('roadType').value;
            
            // ì°¨ì„ ë‹¹ 3.5më¡œ ê³„ì‚°
            const distance = lanes * 3.5;
            
            let walkTime;
            if (roadType === 'school') {
                // ì–´ë¦°ì´ ë³´í˜¸êµ¬ì—­: 7ì´ˆ + (ê±°ë¦¬ Ã— 1.2ì´ˆ/m) - ë” ë§ì€ ì‹œê°„ í•„ìš”
                walkTime = Math.ceil(7 + (distance * 1.2));
            } else {
                // ì¼ë°˜ ë„ë¡œ: 7ì´ˆ + (ê±°ë¦¬ Ã— 0.8ì´ˆ/m)
                walkTime = Math.ceil(7 + (distance * 0.8));
            }
            
            document.getElementById('walkTime').value = walkTime;
            trainingState.settings.walkTime = walkTime;
            
            // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
            const statusBar = document.getElementById('statusBar');
            if (!trainingState.isRunning) {
                statusBar.textContent = `${roadType === 'school' ? 'ì–´ë¦°ì´ ë³´í˜¸êµ¬ì—­' : 'ì¼ë°˜ ë„ë¡œ'} ${lanes}ì°¨ë¡œ (${distance}m) - ë³´í–‰ì‹œê°„ ${walkTime}ì´ˆ`;
            }
        }

        // ì†Œë¦¬ ìƒì„± í•¨ìˆ˜ë“¤
        const sounds = {
            walkStart: () => {
                if (!trainingState.soundEnabled) return;
                // ë³´í–‰ ì‹œì‘ ë©œë¡œë”” (ë ë¦¬ë¦¬ë¦¬~)
                const audio = new AudioContext();
                const frequencies = [523, 659, 784, 988];
                frequencies.forEach((freq, index) => {
                    const oscillator = audio.createOscillator();
                    const gainNode = audio.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audio.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    const startTime = audio.currentTime + index * 0.15;
                    gainNode.gain.setValueAtTime(0.3, startTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + 0.3);
                });
            },
            
            warning: () => {
                if (!trainingState.soundEnabled) return;
                // ê²½ê³ ìŒ (ë¹ ë¥¸ ë¹„í”„ìŒ)
                const audio = new AudioContext();
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const oscillator = audio.createOscillator();
                        const gainNode = audio.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audio.destination);
                        
                        oscillator.frequency.value = 800;
                        oscillator.type = 'square';
                        
                        gainNode.gain.setValueAtTime(0.4, audio.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.1);
                        
                        oscillator.start();
                        oscillator.stop(audio.currentTime + 0.1);
                    }, i * 100);
                }
            },
            
            stop: () => {
                if (!trainingState.soundEnabled) return;
                // ì •ì§€ ì‹ í˜¸ìŒ
                const audio = new AudioContext();
                const oscillator = audio.createOscillator();
                const gainNode = audio.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audio.destination);
                
                oscillator.frequency.value = 400;
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0.3, audio.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audio.currentTime + 0.5);
            }
        };

        function toggleSound() {
            trainingState.soundEnabled = !trainingState.soundEnabled;
            document.querySelector('.sound-btn').textContent = trainingState.soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            showInfoPopup(trainingState.soundEnabled ? 'ì†Œë¦¬ê°€ ì¼œì¡ŒìŠµë‹ˆë‹¤' : 'ì†Œë¦¬ê°€ êº¼ì¡ŒìŠµë‹ˆë‹¤', 'safe');
        }

        function openSettings() {
            document.getElementById('settingsModal').style.display = 'block';
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function showInfoPopup(message, type = '') {
            const popup = document.getElementById('infoPopup');
            popup.textContent = message;
            popup.className = `info-popup show ${type}`;
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        function updateDisplay() {
            const redDisplay = document.getElementById('redDisplay');
            const greenDisplay = document.getElementById('greenDisplay');
            const timer = document.getElementById('timer');
            const countdown = document.getElementById('countdownDisplay');
            const statusBar = document.getElementById('statusBar');
            
            timer.textContent = trainingState.timeLeft;
            
            // ëª¨ë“  ìƒíƒœ ì´ˆê¸°í™”
            redDisplay.classList.remove('active', 'inactive', 'red-active', 'warning');
            greenDisplay.classList.remove('active', 'inactive', 'green-active', 'warning');
            
            switch(trainingState.currentPhase) {
                case 'wait':
                    redDisplay.classList.add('active', 'red-active');
                    greenDisplay.classList.add('inactive');
                    countdown.textContent = trainingState.timeLeft; // ëŒ€ê¸° ì‹œê°„ í‘œì‹œ
                    statusBar.textContent = 'ëŒ€ê¸° ì¤‘ - ë¹¨ê°„ë¶ˆ';
                    break;
                case 'walk':
                    redDisplay.classList.add('inactive');
                    greenDisplay.classList.add('active', 'green-active');
                    countdown.textContent = '--'; // ë³´í–‰ ì¤‘ì—ëŠ” ìˆ«ì ì•ˆë³´ì„
                    statusBar.textContent = 'ë³´í–‰ ì¤‘ - ì´ˆë¡ë¶ˆ';
                    break;
                case 'warning':
                    redDisplay.classList.add('inactive');
                    greenDisplay.classList.add('active', 'green-active', 'warning'); // ì´ˆë¡ë¶ˆì´ ê¹œë¹¡ì„
                    countdown.textContent = trainingState.timeLeft; // ê²½ê³  ì‹œê°„ í‘œì‹œ
                    statusBar.textContent = 'ì„œë‘˜ëŸ¬ ê±´ë„ˆì„¸ìš”!';
                    break;
            }
        }

        function runTrainingCycle() {
            const { walkTime, waitTime, warningTime } = trainingState.settings;
            
            // 1ë‹¨ê³„: ëŒ€ê¸° (ë¹¨ê°„ë¶ˆ)
            trainingState.currentPhase = 'wait';
            trainingState.timeLeft = waitTime;
            updateDisplay();
            showInfoPopup('ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”', 'danger');
            sounds.stop();
            
            const waitInterval = setInterval(() => {
                trainingState.timeLeft--;
                updateDisplay();
                
                if (trainingState.timeLeft <= 0) {
                    clearInterval(waitInterval);
                    
                    // 2ë‹¨ê³„: ë³´í–‰ (ì´ˆë¡ë¶ˆ)
                    trainingState.currentPhase = 'walk';
                    trainingState.timeLeft = walkTime;
                    updateDisplay();
                    showInfoPopup('ì•ˆì „í•˜ê²Œ ê±´ë„ˆì„¸ìš”!', 'safe');
                    sounds.walkStart();
                    
                    const walkInterval = setInterval(() => {
                        trainingState.timeLeft--;
                        updateDisplay();
                        
                        if (trainingState.timeLeft <= warningTime) {
                            clearInterval(walkInterval);
                            
                            // 3ë‹¨ê³„: ê²½ê³  (ê¹œë¹¡ì´ëŠ” ë¹¨ê°„ë¶ˆ)
                            trainingState.currentPhase = 'warning';
                            trainingState.timeLeft = warningTime;
                            updateDisplay();
                            showInfoPopup('ë¹¨ë¦¬ ê±´ë„ˆì„¸ìš”!', 'warning');
                            sounds.warning();
                            
                            const warningInterval = setInterval(() => {
                                trainingState.timeLeft--;
                                updateDisplay();
                                
                                if (trainingState.timeLeft <= 0) {
                                    clearInterval(warningInterval);
                                    
                                    if (trainingState.isRunning) {
                                        // ë‹¤ìŒ ì‚¬ì´í´ ì‹œì‘
                                        setTimeout(runTrainingCycle, 1000);
                                    }
                                }
                            }, 1000);
                        }
                    }, 1000);
                }
            }, 1000);
        }

        function startTraining() {
            // ì„¤ì • ê°’ ê°€ì ¸ì˜¤ê¸°
            trainingState.settings.lanes = parseInt(document.getElementById('lanes').value);
            trainingState.settings.roadType = document.getElementById('roadType').value;
            trainingState.settings.walkTime = parseInt(document.getElementById('walkTime').value);
            trainingState.settings.waitTime = parseInt(document.getElementById('waitTime').value);
            trainingState.settings.warningTime = parseInt(document.getElementById('warningTime').value);
            
            trainingState.isRunning = true;
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-block';
            
            closeSettings();
            
            const roadTypeText = trainingState.settings.roadType === 'school' ? 'ì–´ë¦°ì´ ë³´í˜¸êµ¬ì—­' : 'ì¼ë°˜ ë„ë¡œ';
            const distance = trainingState.settings.lanes * 3.5;
            showInfoPopup(`${roadTypeText} ${trainingState.settings.lanes}ì°¨ë¡œ (${distance}m) í›ˆë ¨ì„ ì‹œì‘í•©ë‹ˆë‹¤!`, 'safe');
            
            // í›ˆë ¨ ì‹œì‘
            setTimeout(runTrainingCycle, 2000);
        }

        function stopTraining() {
            trainingState.isRunning = false;
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            
            // ì´ˆê¸° ìƒíƒœë¡œ ë³µì›
            trainingState.currentPhase = 'wait';
            trainingState.timeLeft = 0;
            updateDisplay();
            document.getElementById('timer').textContent = '--';
            document.getElementById('countdownDisplay').textContent = '--';
            calculateWalkTime(); // ìƒíƒœë°” ì •ë³´ ë³µì›
            
            showInfoPopup('í›ˆë ¨ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤', 'warning');
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ': // ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì„¤ì • ì—´ê¸°
                    e.preventDefault();
                    openSettings();
                    break;
                case 'Escape': // ESCë¡œ ì„¤ì • ë‹«ê¸°
                    closeSettings();
                    break;
                case 's': // Sí‚¤ë¡œ ì†Œë¦¬ í† ê¸€
                    toggleSound();
                    break;
            }
        });

        // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼)
        let touchStartY = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            const touchEndY = e.changedTouches[0].clientY;
            const diff = touchStartY - touchEndY;
            
            // ìœ„ë¡œ ìŠ¤ì™€ì´í”„í•˜ë©´ ì„¤ì • ì—´ê¸°
            if (diff > 50) {
                openSettings();
            }
        });

        // ì´ˆê¸° ì„¤ì •
        updateDisplay();
        calculateWalkTime(); // ì´ˆê¸° ë³´í–‰ ì‹œê°„ ê³„ì‚°
        document.getElementById('countdownDisplay').textContent = '--';
        
        // ì‹œì‘ ì‹œ ì„¤ì • ì°½ ì—´ê¸°
        setTimeout(() => {
            openSettings();
            showInfoPopup('ìœ„ë¡œ ìŠ¤ì™€ì´í”„í•˜ë©´ ì„¤ì •ì„ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'safe');
        }, 500);
    </script>
</body>
</html>
