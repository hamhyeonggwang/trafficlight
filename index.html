        /* 보행자 사람 모양 */
        .pedestrian-figure {
            width: 120px;
            height: 180px;
            position: relative;
            margin: 0 auto;
        }

        /* 머리 */
        .pedestrian-head {
            width:<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보행자 신호등 훈련 시스템</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: white;
            font-family: 'Arial', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            user-select: none;
        }

        /* 전체 신호등 컨테이너 */
        .traffic-light-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* 통합 신호등 박스 */
        .pedestrian-signal {
            width: 320px;
            height: 720px;
            background: #2c3e50;
            border: 8px solid #34495e;
            border-radius: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            padding: 30px 20px;
        }

        /* 대기시간 숫자 표시 */
        .countdown-display {
            width: 200px;
            height: 80px;
            background: #1a1a1a;
            border: 4px solid #333;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            font-weight: bold;
            color: #ff6600;
            text-shadow: 0 0 10px #ff6600;
            margin-top: -10px;
        }

        /* 개별 신호 디스플레이 */
        .signal-display {
            width: 260px;
            height: 280px;
            background: #000;
            border-radius: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            border: 4px solid #444;
            transition: all 0.3s ease;
        }

        /* 비활성화 상태 */
        .signal-display.inactive {
            opacity: 0.2;
            transform: scale(0.98);
            border-color: #222;
        }

        /* 활성화 상태 */
        .signal-display.active {
            opacity: 1;
            transform: scale(1);
            border-color: #666;
        }

        /* 도트 배경 패턴 - 기본 */
        .signal-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 8px 8px;
            opacity: 0.5;
            z-index: 1;
        }

        /* 활성화된 도트 배경 - 빨간불 */
        .signal-display.red-active::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, #ff3333 2.5px, transparent 2.5px);
            background-size: 12px 12px;
            opacity: 0.95;
            z-index: 1;
        }

        /* 활성화된 도트 배경 - 초록불 */
        .signal-display.green-active::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, #33ff33 2.5px, transparent 2.5px);
            background-size: 12px 12px;
            opacity: 0.95;
            z-index: 1;
        }

        /* 초록불 깜빡이는 효과 */
        .signal-display.green-active.warning::after {
            animation: warning-blink 0.5s infinite;
        }

        /* 깜빡이는 효과 */
        .signal-display.warning::after {
            animation: warning-blink 0.5s infinite;
        }

        @keyframes warning-blink {
            0%, 50% { opacity: 0.95; }
            51%, 100% { opacity: 0.2; }
        }

        .signal-icon {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
            transition: all 0.3s ease;
        }

        /* 보행자 사람 모양 */
        .pedestrian-figure {
            width: 100px;
            height: 160px;
            position: relative;
            margin: 0 auto;
        }

        /* 머리 */
        .pedestrian-head {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #000;
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.3s ease;
        }

        /* 몸통 */
        .pedestrian-body {
            width: 18px;
            height: 50px;
            background: #000;
            position: absolute;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.3s ease;
        }

        /* 팔 */
        .pedestrian-arm {
            width: 14px;
            height: 40px;
            background: #000;
            position: absolute;
            top: 50px;
            transition: all 0.3s ease;
            border-radius: 3px;
        }

        .pedestrian-arm.left {
            left: 30px;
            transform: rotate(-15deg);
            transform-origin: top;
        }

        .pedestrian-arm.right {
            right: 30px;
            transform: rotate(15deg);
            transform-origin: top;
        }

        /* 다리 */
        .pedestrian-leg {
            width: 16px;
            height: 60px;
            background: #000;
            position: absolute;
            top: 95px;
            transition: all 0.3s ease;
            border-radius: 3px;
        }

        .pedestrian-leg.left {
            left: 38px;
        }

        .pedestrian-leg.right {
            right: 38px;
        }

        /* 빨간불 상태 */
        .signal-icon.red .pedestrian-figure * {
            background: #000;
            box-shadow: 0 0 15px #ff3333, inset 0 0 3px rgba(255,51,51,0.3);
        }

        /* 초록불 상태 */
        .signal-icon.green .pedestrian-figure * {
            background: #000;
            box-shadow: 0 0 15px #33ff33, inset 0 0 3px rgba(51,255,51,0.3);
        }

        /* 초록불일 때 걷는 자세 */
        .signal-icon.green .pedestrian-arm.left {
            transform: rotate(30deg); /* 왼팔 앞으로 */
        }

        .signal-icon.green .pedestrian-arm.right {
            transform: rotate(-30deg); /* 오른팔 뒤로 */
        }

        .signal-icon.green .pedestrian-leg.left {
            transform: rotate(15deg); /* 왼다리 앞으로 */
        }

        .signal-icon.green .pedestrian-leg.right {
            transform: rotate(-10deg); /* 오른다리 뒤로 */
        }

        /* 신호등 라벨 */
        .signal-label {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            font-weight: bold;
            color: #ecf0f1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        /* 타이머 */
        .timer-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
            font-size: min(15vw, 80px);
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
            z-index: 10;
            background: rgba(0,0,0,0.3);
            padding: min(4vw, 20px) min(8vw, 40px);
            border-radius: 20px;
            border: 3px solid rgba(255,255,255,0.2);
        }

        /* 설정 버튼 */
        .settings-btn {
            position: fixed;
            top: min(4vw, 20px);
            right: min(4vw, 20px);
            background: rgba(52, 73, 94, 0.9);
            border: none;
            color: white;
            padding: min(3vw, 15px);
            border-radius: 50%;
            cursor: pointer;
            font-size: min(6vw, 24px);
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .sound-btn {
            position: fixed;
            top: min(4vw, 20px);
            left: min(4vw, 20px);
            background: rgba(52, 73, 94, 0.9);
            border: none;
            color: white;
            padding: min(3vw, 15px);
            border-radius: 50%;
            cursor: pointer;
            font-size: min(6vw, 24px);
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* 팝업 모달 */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            overflow-y: auto;
        }

        .modal-content {
            background-color: #2c3e50;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            color: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        .modal h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #3498db;
            font-size: 1.8em;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .setting-group {
            text-align: center;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
            font-weight: bold;
            color: #ecf0f1;
        }

        .setting-group select,
        .setting-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            background: #34495e;
            color: white;
            text-align: center;
        }

        .modal-buttons {
            text-align: center;
            margin-top: 25px;
        }

        .modal-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 5px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .modal-btn:hover {
            background: #2980b9;
        }

        .modal-btn.start {
            background: #27ae60;
        }

        .modal-btn.start:hover {
            background: #229954;
        }

        .modal-btn.stop {
            background: #e74c3c;
        }

        .modal-btn.stop:hover {
            background: #c0392b;
        }

        /* 안내 팝업 */
        .info-popup {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(52, 73, 94, 0.95);
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            z-index: 1500;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            display: none;
            max-width: 90%;
        }

        .info-popup.show {
            display: block;
            animation: popup-show 0.5s ease;
        }

        @keyframes popup-show {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            100% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .info-popup.safe {
            background: rgba(39, 174, 96, 0.95);
        }

        .info-popup.danger {
            background: rgba(231, 76, 60, 0.95);
        }

        .info-popup.warning {
            background: rgba(243, 156, 18, 0.95);
        }

        /* 상태 표시 */
        .status-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(52, 73, 94, 0.9);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            text-align: center;
            max-width: 90%;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #7f8c8d;
            font-size: 24px;
            cursor: pointer;
        }

        /* 모바일 최적화 */
        @media (max-width: 480px) {
            .pedestrian-signal {
                border: 6px solid #34495e;
                border-radius: 30px;
            }
            
            .signal-display {
                border: 3px solid #444;
                border-radius: 20px;
            }
            
            .countdown-display {
                border: 3px solid #333;
                border-radius: 12px;
            }
        }

        /* 가로 모드 대응 */
        @media (orientation: landscape) and (max-height: 600px) {
            .pedestrian-signal {
                width: min(50vw, 300px);
                height: min(90vh, 500px);
                padding: 2vh 2vw;
            }
            
            .timer-display {
                font-size: min(12vw, 60px);
                padding: min(2vw, 15px) min(4vw, 25px);
            }
        }
    </style>
</head>
<body>
    <!-- 소리 토글 버튼 -->
    <button class="sound-btn" onclick="toggleSound()">🔊</button>
    
    <!-- 설정 버튼 -->
    <button class="settings-btn" onclick="openSettings()">⚙️</button>
    
    <!-- 메인 신호등 -->
    <div class="traffic-light-container">
        <div class="pedestrian-signal">
            <!-- 빨간불 (위쪽) -->
            <div class="signal-display active" id="redDisplay">
                <div class="signal-icon red">
                    <div class="pedestrian-figure">
                        <div class="pedestrian-head"></div>
                        <div class="pedestrian-body"></div>
                        <div class="pedestrian-arm left"></div>
                        <div class="pedestrian-arm right"></div>
                        <div class="pedestrian-leg left"></div>
                        <div class="pedestrian-leg right"></div>
                    </div>
                </div>
            </div>

            <!-- 초록불 (아래쪽) -->
            <div class="signal-display inactive" id="greenDisplay">
                <div class="signal-icon green">
                    <div class="pedestrian-figure">
                        <div class="pedestrian-head"></div>
                        <div class="pedestrian-body"></div>
                        <div class="pedestrian-arm left"></div>
                        <div class="pedestrian-arm right"></div>
                        <div class="pedestrian-leg left"></div>
                        <div class="pedestrian-leg right"></div>
                    </div>
                </div>
            </div>
            
            <!-- 대기시간 숫자 표시 -->
            <div class="countdown-display" id="countdownDisplay">--</div>
        </div>
    </div>

    <!-- 타이머 -->
    <div class="timer-display" id="timer">--</div>

    <!-- 상태 표시 -->
    <div class="status-bar" id="statusBar">대기 중...</div>

    <!-- 안내 팝업 -->
    <div class="info-popup" id="infoPopup"></div>

    <!-- 설정 모달 -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeSettings()">✕</button>
            <h2>🚦 신호등 설정</h2>
            
            <div class="settings-grid">
                <div class="setting-group">
                    <label for="lanes">도로 차선 수</label>
                    <select id="lanes" onchange="calculateWalkTime()">
                        <option value="1">1차로 (3.5m)</option>
                        <option value="2" selected>2차로 (7m)</option>
                        <option value="3">3차로 (10.5m)</option>
                        <option value="4">4차로 (14m)</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="roadType">도로 유형</label>
                    <select id="roadType" onchange="calculateWalkTime()">
                        <option value="normal">일반 도로</option>
                        <option value="school" selected>어린이 보호구역</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="walkTime">보행 시간 (초)</label>
                    <input type="number" id="walkTime" value="13" min="10" max="30" readonly>
                    <small style="color: #bdc3c7; font-size: 12px;">자동 계산됨</small>
                </div>
                
                <div class="setting-group">
                    <label for="waitTime">대기 시간 (초)</label>
                    <input type="number" id="waitTime" value="30" min="20" max="60">
                </div>
                
                <div class="setting-group">
                    <label for="warningTime">경고 시간 (초)</label>
                    <input type="number" id="warningTime" value="5" min="3" max="10">
                </div>
                
                <div class="setting-group">
                    <div style="background: rgba(52, 152, 219, 0.2); padding: 15px; border-radius: 10px; font-size: 14px;">
                        <strong>📏 계산 공식:</strong><br>
                        • 일반 도로: 진입시간 7초 + (거리 × 0.8초/m)<br>
                        • 어린이 보호구역: 진입시간 7초 + (거리 × 1.2초/m)
                    </div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn start" onclick="startTraining()" id="startBtn">🚦 훈련 시작</button>
                <button class="modal-btn stop" onclick="stopTraining()" id="stopBtn" style="display:none;">⏹️ 훈련 중지</button>
                <button class="modal-btn" onclick="closeSettings()">닫기</button>
            </div>
        </div>
    </div>

    <script>
        let trainingState = {
            isRunning: false,
            currentPhase: 'wait', // 'wait', 'walk', 'warning'
            timeLeft: 0,
            soundEnabled: true,
            intervalId: null,
            settings: {
                lanes: 2,
                roadType: 'school',
                walkTime: 13,
                waitTime: 30,
                warningTime: 5
            }
        };

        // 횡단보도 거리 및 보행 시간 계산
        function calculateWalkTime() {
            const lanes = parseInt(document.getElementById('lanes').value);
            const roadType = document.getElementById('roadType').value;
            
            // 차선당 3.5m로 계산
            const distance = lanes * 3.5;
            
            let walkTime;
            if (roadType === 'school') {
                // 어린이 보호구역: 7초 + (거리 × 1.2초/m) - 더 많은 시간 필요
                walkTime = Math.ceil(7 + (distance * 1.2));
            } else {
                // 일반 도로: 7초 + (거리 × 0.8초/m)
                walkTime = Math.ceil(7 + (distance * 0.8));
            }
            
            document.getElementById('walkTime').value = walkTime;
            trainingState.settings.walkTime = walkTime;
            
            // 상태 표시 업데이트
            const statusBar = document.getElementById('statusBar');
            if (!trainingState.isRunning) {
                statusBar.textContent = `${roadType === 'school' ? '어린이 보호구역' : '일반 도로'} ${lanes}차로 (${distance}m) - 보행시간 ${walkTime}초`;
            }
        }

        // 소리 생성 함수들
        const sounds = {
            walkStart: () => {
                if (!trainingState.soundEnabled) return;
                // 보행 시작 멜로디 (띠리리리~)
                const audio = new AudioContext();
                const frequencies = [523, 659, 784, 988];
                frequencies.forEach((freq, index) => {
                    const oscillator = audio.createOscillator();
                    const gainNode = audio.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audio.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';
                    
                    const startTime = audio.currentTime + index * 0.15;
                    gainNode.gain.setValueAtTime(0.3, startTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + 0.3);
                });
            },
            
            warning: () => {
                if (!trainingState.soundEnabled) return;
                // 경고음 (빠른 비프음)
                const audio = new AudioContext();
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const oscillator = audio.createOscillator();
                        const gainNode = audio.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audio.destination);
                        
                        oscillator.frequency.value = 800;
                        oscillator.type = 'square';
                        
                        gainNode.gain.setValueAtTime(0.4, audio.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.1);
                        
                        oscillator.start();
                        oscillator.stop(audio.currentTime + 0.1);
                    }, i * 100);
                }
            },
            
            stop: () => {
                if (!trainingState.soundEnabled) return;
                // 정지 신호음
                const audio = new AudioContext();
                const oscillator = audio.createOscillator();
                const gainNode = audio.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audio.destination);
                
                oscillator.frequency.value = 400;
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0.3, audio.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audio.currentTime + 0.5);
            }
        };

        function toggleSound() {
            trainingState.soundEnabled = !trainingState.soundEnabled;
            document.querySelector('.sound-btn').textContent = trainingState.soundEnabled ? '🔊' : '🔇';
            showInfoPopup(trainingState.soundEnabled ? '소리가 켜졌습니다' : '소리가 꺼졌습니다', 'safe');
        }

        function openSettings() {
            document.getElementById('settingsModal').style.display = 'block';
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function showInfoPopup(message, type = '') {
            const popup = document.getElementById('infoPopup');
            popup.textContent = message;
            popup.className = `info-popup show ${type}`;
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        function updateDisplay() {
            const redDisplay = document.getElementById('redDisplay');
            const greenDisplay = document.getElementById('greenDisplay');
            const timer = document.getElementById('timer');
            const countdown = document.getElementById('countdownDisplay');
            const statusBar = document.getElementById('statusBar');
            
            timer.textContent = trainingState.timeLeft;
            
            // 모든 상태 초기화
            redDisplay.classList.remove('active', 'inactive', 'red-active', 'warning');
            greenDisplay.classList.remove('active', 'inactive', 'green-active', 'warning');
            
            switch(trainingState.currentPhase) {
                case 'wait':
                    redDisplay.classList.add('active', 'red-active');
                    greenDisplay.classList.add('inactive');
                    countdown.textContent = trainingState.timeLeft; // 대기 시간 표시
                    statusBar.textContent = '대기 중 - 빨간불';
                    break;
                case 'walk':
                    redDisplay.classList.add('inactive');
                    greenDisplay.classList.add('active', 'green-active');
                    countdown.textContent = '--'; // 보행 중에는 숫자 안보임
                    statusBar.textContent = '보행 중 - 초록불';
                    break;
                case 'warning':
                    redDisplay.classList.add('inactive');
                    greenDisplay.classList.add('active', 'green-active', 'warning'); // 초록불이 깜빡임
                    countdown.textContent = trainingState.timeLeft; // 경고 시간 표시
                    statusBar.textContent = '서둘러 건너세요!';
                    break;
            }
        }

        function runTrainingCycle() {
            const { walkTime, waitTime, warningTime } = trainingState.settings;
            
            // 1단계: 대기 (빨간불)
            trainingState.currentPhase = 'wait';
            trainingState.timeLeft = waitTime;
            updateDisplay();
            showInfoPopup('잠시 기다려 주세요', 'danger');
            sounds.stop();
            
            const waitInterval = setInterval(() => {
                trainingState.timeLeft--;
                updateDisplay();
                
                if (trainingState.timeLeft <= 0) {
                    clearInterval(waitInterval);
                    
                    // 2단계: 보행 (초록불)
                    trainingState.currentPhase = 'walk';
                    trainingState.timeLeft = walkTime;
                    updateDisplay();
                    showInfoPopup('안전하게 건너세요!', 'safe');
                    sounds.walkStart();
                    
                    const walkInterval = setInterval(() => {
                        trainingState.timeLeft--;
                        updateDisplay();
                        
                        if (trainingState.timeLeft <= warningTime) {
                            clearInterval(walkInterval);
                            
                            // 3단계: 경고 (깜빡이는 빨간불)
                            trainingState.currentPhase = 'warning';
                            trainingState.timeLeft = warningTime;
                            updateDisplay();
                            showInfoPopup('빨리 건너세요!', 'warning');
                            sounds.warning();
                            
                            const warningInterval = setInterval(() => {
                                trainingState.timeLeft--;
                                updateDisplay();
                                
                                if (trainingState.timeLeft <= 0) {
                                    clearInterval(warningInterval);
                                    
                                    if (trainingState.isRunning) {
                                        // 다음 사이클 시작
                                        setTimeout(runTrainingCycle, 1000);
                                    }
                                }
                            }, 1000);
                        }
                    }, 1000);
                }
            }, 1000);
        }

        function startTraining() {
            // 설정 값 가져오기
            trainingState.settings.lanes = parseInt(document.getElementById('lanes').value);
            trainingState.settings.roadType = document.getElementById('roadType').value;
            trainingState.settings.walkTime = parseInt(document.getElementById('walkTime').value);
            trainingState.settings.waitTime = parseInt(document.getElementById('waitTime').value);
            trainingState.settings.warningTime = parseInt(document.getElementById('warningTime').value);
            
            trainingState.isRunning = true;
            
            // UI 업데이트
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-block';
            
            closeSettings();
            
            const roadTypeText = trainingState.settings.roadType === 'school' ? '어린이 보호구역' : '일반 도로';
            const distance = trainingState.settings.lanes * 3.5;
            showInfoPopup(`${roadTypeText} ${trainingState.settings.lanes}차로 (${distance}m) 훈련을 시작합니다!`, 'safe');
            
            // 훈련 시작
            setTimeout(runTrainingCycle, 2000);
        }

        function stopTraining() {
            trainingState.isRunning = false;
            
            // UI 업데이트
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            
            // 초기 상태로 복원
            trainingState.currentPhase = 'wait';
            trainingState.timeLeft = 0;
            updateDisplay();
            document.getElementById('timer').textContent = '--';
            document.getElementById('countdownDisplay').textContent = '--';
            calculateWalkTime(); // 상태바 정보 복원
            
            showInfoPopup('훈련이 중지되었습니다', 'warning');
        }

        // 키보드 단축키
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ': // 스페이스바로 설정 열기
                    e.preventDefault();
                    openSettings();
                    break;
                case 'Escape': // ESC로 설정 닫기
                    closeSettings();
                    break;
                case 's': // S키로 소리 토글
                    toggleSound();
                    break;
            }
        });

        // 터치 이벤트 (모바일)
        let touchStartY = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            const touchEndY = e.changedTouches[0].clientY;
            const diff = touchStartY - touchEndY;
            
            // 위로 스와이프하면 설정 열기
            if (diff > 50) {
                openSettings();
            }
        });

        // 초기 설정
        updateDisplay();
        calculateWalkTime(); // 초기 보행 시간 계산
        document.getElementById('countdownDisplay').textContent = '--';
        
        // 시작 시 설정 창 열기
        setTimeout(() => {
            openSettings();
            showInfoPopup('위로 스와이프하면 설정을 열 수 있습니다', 'safe');
        }, 500);
    </script>
</body>
</html>
